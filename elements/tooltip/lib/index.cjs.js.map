{"version":3,"file":"index.cjs.js","sources":["../src/tooltip.js"],"sourcesContent":["import { UpgradedElement, register } from \"upgraded-element\"\nimport styles from \"./styles.scss\"\n\nconst Attributes = {\n  POSITION: \"position\",\n  MODE: \"mode\",\n  SHOW_ARROW: \"show-arrow\",\n}\n\nconst Positions = {\n  BLOCK_START: \"block-start\",\n  BLOCK_END: \"block-end\",\n  INLINE_START: \"inline-start\",\n  INLINE_END: \"inline-end\",\n}\n\nconst Modes = {\n  DARK: \"dark\",\n  LIGHT: \"light\",\n}\n\nconst ClassNames = {\n  ARROW: \"arrow\",\n  VISIBLE: \"visible\",\n  HIDDEN: \"hidden\",\n}\n\nconst TIMEOUT_DELAY = 300\n\nclass SpiderTooltip extends UpgradedElement {\n  static get properties() {\n    return {\n      isVisible: {\n        type: \"boolean\",\n        default: false,\n      },\n    }\n  }\n\n  static get styles() {\n    return styles\n  }\n\n  get classNames() {\n    const showArrow = this.hasAttribute(Attributes.SHOW_ARROW)\n    const positionValue = this.getAttribute(Attributes.POSITION)\n    const modeValue = this.getAttribute(Attributes.MODE)\n\n    const position = Object.values(Positions).includes(positionValue)\n      ? positionValue\n      : Positions.BLOCK_START\n    const mode = Object.values(Modes).includes(modeValue)\n      ? modeValue\n      : Modes.DARK\n    const hasArrow = showArrow ? ClassNames.ARROW : \"\"\n    const isVisible = this.isVisible ? ClassNames.VISIBLE : ClassNames.HIDDEN\n\n    return { position, mode, hasArrow, isVisible }\n  }\n\n  constructor() {\n    super()\n    this.trigger = null\n    this.content = null\n    this.timeout = null\n    this.handleOpen = this.handleOpen.bind(this)\n    this.handleClose = this.handleClose.bind(this)\n    this.handleKeydown = this.handleKeydown.bind(this)\n    this.removeTimeout = this.removeTimeout.bind(this)\n  }\n\n  elementDidMount() {\n    // set nodes\n    this.trigger = this.querySelector(\"[slot='trigger']\")\n    this.content = this.querySelector(\"[slot='content']\")\n\n    // set attributes\n    this.trigger.setAttribute(\"aria-describedby\", this.elementId)\n    this.content.id = this.elementId\n    this.content.setAttribute(\"role\", \"tooltip\")\n\n    this.addOpenListeners()\n    this.addCloseListeners()\n  }\n\n  elementWillUnmount() {\n    this.trigger = null\n    this.content = null\n\n    this.removeOpenListeners()\n    this.removeCloseListeners()\n\n    if (this.isVisible) {\n      this.removeCloseCancelListeners()\n    } else {\n      this.removeOpenCancelListeners()\n    }\n  }\n\n  elementDidUpdate() {\n    if (this.isVisible) {\n      if (this.isInlineTooltip()) {\n        this.alignTooltip(\"height\")\n      } else {\n        this.alignTooltip(\"width\")\n      }\n    }\n  }\n\n  listen(type, target, handler) {\n    target.addEventListener(type, handler)\n  }\n\n  sleep(type, target, handler) {\n    target.removeEventListener(type, handler)\n  }\n\n  addOpenListeners() {\n    this.listen(\"focus\", this.trigger, this.handleOpen)\n    this.listen(\"focus\", this.content, this.handleOpen)\n    this.listen(\"mouseover\", this.trigger, this.handleOpen)\n    this.listen(\"mouseover\", this.content, this.handleOpen)\n  }\n\n  addCloseListeners() {\n    this.listen(\"blur\", this.trigger, this.handleClose)\n    this.listen(\"blur\", this.content, this.handleClose)\n    this.listen(\"mouseout\", this.trigger, this.handleClose)\n    this.listen(\"mouseout\", this.content, this.handleClose)\n    this.listen(\"keydown\", window, this.handleKeydown)\n  }\n\n  removeOpenListeners() {\n    this.sleep(\"focus\", this.trigger, this.handleOpen)\n    this.sleep(\"focus\", this.content, this.handleOpen)\n    this.sleep(\"mouseover\", this.trigger, this.handleOpen)\n    this.sleep(\"mouseover\", this.content, this.handleOpen)\n  }\n\n  removeCloseListeners() {\n    this.sleep(\"blur\", this.trigger, this.handleClose)\n    this.sleep(\"blur\", this.content, this.handleClose)\n    this.sleep(\"mouseout\", this.trigger, this.handleClose)\n    this.sleep(\"mouseout\", this.content, this.handleClose)\n    this.sleep(\"keydown\", window, this.handleKeydown)\n  }\n\n  removeOpenCancelListeners() {\n    this.sleep(\"mouseout\", this.trigger, this.removeTimeout)\n    this.sleep(\"blur\", this.trigger, this.removeTimeout)\n    this.sleep(\"mouseout\", this.content, this.removeTimeout)\n  }\n\n  removeCloseCancelListeners() {\n    this.sleep(\"mouseover\", this.trigger, this.removeTimeout)\n    this.sleep(\"focus\", this.trigger, this.removeTimeout)\n    this.sleep(\"mouseover\", this.content, this.removeTimeout)\n  }\n\n  addOpenCancelListeners() {\n    this.listen(\"mouseout\", this.trigger, this.removeTimeout)\n    this.listen(\"blur\", this.trigger, this.removeTimeout)\n    this.listen(\"mouseout\", this.content, this.removeTimeout)\n  }\n\n  addCloseCancelListeners() {\n    this.listen(\"mouseover\", this.trigger, this.removeTimeout)\n    this.listen(\"focus\", this.trigger, this.removeTimeout)\n    this.listen(\"mouseover\", this.content, this.removeTimeout)\n  }\n\n  handleKeydown(event) {\n    if (this.isVisible && event.key === \"Escape\") {\n      this.removeTimeout()\n      this.isVisible = false\n    }\n  }\n\n  removeTimeout() {\n    if (this.timeout) clearTimeout(this.timeout)\n  }\n\n  handleOpen() {\n    if (this.isVisible) return\n\n    this.timeout = setTimeout(() => {\n      this.removeOpenCancelListeners()\n      this.timeout = null\n      this.isVisible = true\n    }, TIMEOUT_DELAY)\n\n    this.addOpenCancelListeners()\n  }\n\n  handleClose() {\n    if (!this.isVisible) return\n\n    this.timeout = setTimeout(() => {\n      this.removeCloseCancelListeners()\n      this.timeout = null\n      this.isVisible = false\n    }, TIMEOUT_DELAY)\n\n    this.addCloseCancelListeners()\n  }\n\n  alignTooltip(dimension) {\n    const triggerSize = this.getSize(this.trigger, dimension)\n    const tooltipSize = this.getSize(this.content, dimension)\n    const triggerIsBigger = triggerSize > tooltipSize\n\n    const offset = triggerIsBigger\n      ? (triggerSize - tooltipSize) / 2\n      : (tooltipSize - triggerSize) / -2\n\n    if (dimension === \"height\") {\n      this.content.style.top = `${offset}px`\n    } else {\n      this.content.style.left = `${offset}px`\n    }\n  }\n\n  getSize(element, property) {\n    return Math.floor(element.getBoundingClientRect()[property])\n  }\n\n  isInlineTooltip() {\n    const position = this.getAttribute(Attributes.POSITION)\n    return [Positions.INLINE_START, Positions.INLINE_END].includes(position)\n  }\n\n  render() {\n    const { position, mode, hasArrow, isVisible } = this.classNames\n\n    return `\n      <div class=\"tooltip ${isVisible} ${position} ${mode} ${hasArrow}\">\n        <slot name=\"trigger\"></slot>\n        <slot name=\"content\"></slot>\n      </div>\n    `\n  }\n}\n\nregister(\"spider-tooltip\", SpiderTooltip)\n"],"names":["Attributes","POSITION","MODE","SHOW_ARROW","Positions","BLOCK_START","BLOCK_END","INLINE_START","INLINE_END","Modes","DARK","LIGHT","ClassNames","ARROW","VISIBLE","HIDDEN","TIMEOUT_DELAY","SpiderTooltip","showArrow","hasAttribute","positionValue","getAttribute","modeValue","position","Object","values","includes","mode","hasArrow","isVisible","type","default","styles","trigger","content","timeout","handleOpen","bind","handleClose","handleKeydown","removeTimeout","querySelector","setAttribute","elementId","id","addOpenListeners","addCloseListeners","removeOpenListeners","removeCloseListeners","removeCloseCancelListeners","removeOpenCancelListeners","isInlineTooltip","alignTooltip","target","handler","addEventListener","removeEventListener","listen","window","sleep","event","key","clearTimeout","setTimeout","addOpenCancelListeners","addCloseCancelListeners","dimension","triggerSize","getSize","tooltipSize","triggerIsBigger","offset","style","top","left","element","property","Math","floor","getBoundingClientRect","classNames","UpgradedElement","register"],"mappings":"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"}